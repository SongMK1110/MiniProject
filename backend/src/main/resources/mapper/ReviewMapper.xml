<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.product.mapper.ReviewMapper">
  <select id="selectReviewProduct" resultType="ProductVO">
  	SELECT 	*
	FROM 	product p 
	JOIN 	image i 
	ON 		p.product_id = i.product_id
	WHERE 	p.product_id = #{productId}
	AND 	i.main = 'Y'
  </select>

  <insert id="insertReview" parameterType="ReviewVO">
  	INSERT INTO review ( product_id,
  						 member_id,
  						 content,
  						 rate,
  						 size,
  						 brightness,
  						 color,
  						 thickness,
  						 delivery,
  						 packaging )
  				VALUES ( #{productId},
  						 #{memberId},
  						 #{content},
  						 #{rate},
  						 #{size},
  						 #{brightness},
  						 #{color},
  						 #{thickness},
  						 #{delivery},
  						 #{packaging} )
  </insert>

  <select id="selectReviewList" resultType="ReviewVO">
  	SELECT 	*
  	FROM	review
  	WHERE	member_id = #{memberId}
  </select>
  
  <select id="selectReviewProductDetail" resultType="ReviewVO">
  	SELECT 	*
  	FROM	review r
  	JOIN	`member` m
  	ON		r.member_id = m.member_id
  	WHERE	product_id = #{productId}
  </select>
  
  <select id="selectReviewRateAvg" resultType="double">
  	SELECT 	AVG(rate) as avg
	FROM 	review
	WHERE 	product_id = #{productId}
  </select>
  
</mapper>